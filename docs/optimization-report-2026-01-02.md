# ChaosRPS.io 성능 최적화 보고서

**작성일**: 2026-01-02  
**버전**: v1.4.1

---

## 📊 성능 분석 결과 (문제 발생 PC 측정)

### Chrome Performance 탭 분석

**측정 환경**: RTX 2070 + i5-9400f, Chrome

| 지표 | 측정값 | 평가 |
|------|--------|------|
| **INP** | 108ms | ⚠️ 게임용으로 높음 |
| **Scripting** | 14,136ms (98%) | ❌ 심각한 병목 |
| **Rendering** | 86ms (0.6%) | ✅ 정상 |
| **Painting** | 42ms (0.3%) | ✅ 정상 |
| **System** | 266ms | ✅ 정상 |
| **Total** | 14,556ms | - |

**Flame Graph 관찰 결과**:
- `Main` 스레드에 노란색 (JavaScript) 블록이 연속으로 채워짐
- `step`, `render` 함수가 반복 호출됨 (Phaser 게임 루프)
- `An...ed`, `Fun...ll` 등 익명 함수들이 자주 나타남
- 빨간색 삼각형 (Long Task) 경고 다수 발생

### Chrome Network 탭 분석

| 항목 | 값 |
|------|-----|
| 요청 수 | 29개 |
| 전송 크기 | 14.6 KB |
| 리소스 크기 | 85.2 KB |
| WebSocket 연결 | 13.52초 유지 (정상) |
| XHR 응답 시간 | 250-400ms |

**관찰 결과**:
- WebSocket 연결 정상 유지
- 여러 `socket.io` 폴링 요청 확인
- 네트워크는 병목이 아님

---

## ✅ 완료된 최적화

### 서버 측
| 항목 | 파일 | 효과 |
|------|------|------|
| **Spatial Hash Grid** | `SpatialHashGrid.ts` | 충돌 검사 O(n²) → O(n) |
| **네트워크 20Hz 분리** | `GameRoom.ts` | 브로드캐스트 3배 감소 |
| **실제 deltaTime** | `GameRoom.ts` | 환경별 속도 일관성 |

### 클라이언트 측
| 항목 | 파일 | 효과 |
|------|------|------|
| **Object Pool** | `PlayerRenderer.ts` | Container 재사용 |
| **초기 스냅샷 추가** | `interpolationService.ts` | 첫 프레임 렉 방지 |

---

## 🐛 발견된 버그

### BUG-001: 사설방에서 죽고 다시하기 시 다른 방으로 입장
- **재현 경로**: 방 만들기 → 게임 플레이 → 사망 → "다시하기" 클릭
- **예상 동작**: 같은 사설방에서 재시작
- **실제 동작**: 완전히 다른 공개방으로 입장됨
- **심각도**: 🔴 높음

### BUG-002: 방 코드 변경 시 URL 미갱신
- **재현 경로**: 코드로 방 입장 → 사망 → 다른 코드로 입장하기
- **예상 동작**: URL이 새 방 코드로 업데이트
- **실제 동작**: URL은 이전 방 링크로 유지됨
- **심각도**: 🟡 중간

### BUG-003: 특정 PC에서 타이머 UI 업데이트 안됨
- **재현 환경**: 일부 PC에서만 발생 (RTX 2070 + i5-9400f에서 발생, GTX 1650 + i5-11400f에서는 정상)
- **증상**: 
  - 변신 타이머가 거의 차지 않음
  - 타이머가 꺼져있는 것처럼 보임
  - 변신 타이밍 예측 불가
- **가능한 원인**:
  - 메인 스레드 블로킹 (Scripting 14초)
  - React 리렌더링 실패
  - 하드웨어 가속 비활성화
- **심각도**: 🔴 높음

### BUG-004: 특정 PC에서 캐릭터 떨림/끊김
- **재현 환경**: 일부 PC에서만 발생
- **증상**: 다른 플레이어 캐릭터 움직임이 떨리고 부드럽지 않음
- **가능한 원인**: JavaScript Scripting 과부하
- **심각도**: 🔴 높음

---

## 🔍 환경별 차이 분석

| 항목 | 문제 발생 PC | 정상 PC |
|------|-------------|--------|
| CPU | i5-9400f | i5-11400f |
| GPU | RTX 2070 | GTX 1650 |
| 결과 | ❌ 렉, 타이머 안됨 | ✅ 정상 |

> **결론**: 하드웨어 차이로 설명되지 않음. 소프트웨어 환경 (Chrome 설정, 확장프로그램 등) 차이 의심

---

## 🔧 추가 최적화 권장사항

### P1: PlayerRenderer Graphics 최적화
- `Graphics.clear()` 호출 최소화
- 상태 변경 시에만 다시 그리기

### P2: React 최적화
- `React.memo()` 적용
- useSelector 세분화

### P3: 렌더링 최적화
- 화면 밖 플레이어 완전 스킵
- LOD (Level of Detail) 구현

---

## 📝 결론

서버 측 최적화는 완료되었으나, 일부 환경에서 심각한 클라이언트 성능 문제가 발견됨.
- **버그 4건** 발견 (사설방 2건, 성능 관련 2건)
- **PlayerRenderer 최적화** 필요
- **환경별 차이 조사** 필요 (Chrome 설정, 하드웨어 가속 등)
