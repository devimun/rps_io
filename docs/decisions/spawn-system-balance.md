# 스폰 시스템 밸런스 설계 결정

## 개요

ChaosRPS.io의 스폰 시스템을 세계적 수준의 IO 게임(slither.io, agar.io)과 비교 분석하고, 20명 규모의 게임에 최적화된 스폰 시스템을 설계합니다.

## 1. IO 게임 스폰 시스템 비교 분석

### 1.1 slither.io 방식

slither.io는 **밀도 기반 스폰 시스템**을 사용합니다:

- **맵 크기**: 약 21,600 x 21,600 픽셀 (매우 큼)
- **스폰 전략**: 맵을 격자로 나누고, 플레이어 밀도가 낮은 영역에 스폰
- **안전 거리**: 다른 플레이어와 일정 거리 이상 떨어진 위치 선택
- **무적 시간**: 없음 (대신 안전한 위치에 스폰)
- **장점**: 공정한 시작, 즉시 게임 참여 가능
- **단점**: 맵이 매우 커서 초반에 다른 플레이어를 찾기 어려움

### 1.2 agar.io 방식

agar.io는 **랜덤 스폰 + 무적 시간** 방식을 사용합니다:

- **맵 크기**: 약 14,142 x 14,142 픽셀
- **스폰 전략**: 완전 랜덤 위치 (경계 여백만 적용)
- **안전 거리**: 없음
- **무적 시간**: 짧은 무적 시간 부여
- **장점**: 구현 간단, 빠른 스폰
- **단점**: 스폰 킬(spawn kill) 가능성 존재

### 1.3 diep.io 방식

diep.io는 **영역 기반 스폰**을 사용합니다:

- **맵 크기**: 약 11,000 x 11,000 픽셀
- **스폰 전략**: 맵 중앙 근처에서 스폰 (위험 지역 회피)
- **안전 거리**: 적 플레이어와 일정 거리 유지
- **무적 시간**: 짧은 무적 시간 + 투명 효과
- **장점**: 초보자 보호, 점진적 난이도
- **단점**: 중앙 혼잡 가능성

## 2. 스폰 알고리즘 비교

### 2.1 격자 기반 스폰 (Grid-based Spawn)

```
장점:
- O(n) 시간 복잡도로 밀도 계산 가능
- 구현이 직관적
- 메모리 효율적

단점:
- 격자 크기에 따라 정밀도 변화
- 격자 경계에서 불균형 발생 가능
```

### 2.2 쿼드트리 기반 스폰 (Quadtree-based Spawn)

```
장점:
- 동적 공간 분할로 정밀한 밀도 계산
- 플레이어 분포에 적응적

단점:
- 구현 복잡도 높음
- 20명 규모에서는 오버엔지니어링
```

### 2.3 랜덤 샘플링 (Random Sampling)

```
장점:
- 구현 매우 간단
- 빠른 실행 속도

단점:
- 안전한 위치 보장 어려움
- 최악의 경우 무한 루프 가능성
```

## 3. ChaosRPS.io 최적 설계 결정

### 3.1 선택: 격자 기반 스폰 + 안전 거리 검증

20명 규모의 게임에서는 **격자 기반 스폰**이 가장 적합합니다:

- 플레이어 수가 적어 쿼드트리의 이점이 미미함
- 격자 기반으로 충분한 정밀도 확보 가능
- 구현 및 유지보수 용이

### 3.2 월드맵 크기 분석

현재 설정:
- WORLD_SIZE: 2000 x 2000 픽셀
- MAX_PLAYERS: 20명
- DEFAULT_PLAYER_SIZE: 40픽셀 (반지름)

**플레이어당 평균 영역 계산:**
```
총 면적 = 2000 * 2000 = 4,000,000 px²
플레이어당 면적 = 4,000,000 / 20 = 200,000 px²
플레이어당 영역 반지름 ≈ √(200,000/π) ≈ 252 px
```

**안전 스폰 거리 분석:**
- 현재 SAFE_SPAWN_DISTANCE: 300px
- 플레이어 크기(40px) + 안전 거리(300px) = 340px 필요
- 플레이어당 영역(252px)보다 큼 → 20명 모두 안전 스폰 불가능

### 3.3 최적 값 결정

**옵션 A: 맵 크기 증가**
```
필요 면적 = 20 * π * (340)² ≈ 7,260,000 px²
필요 맵 크기 ≈ 2,694 x 2,694 px
→ 3000 x 3000 px 권장
```

**옵션 B: 안전 거리 감소**
```
현재 맵(2000x2000)에서 가능한 안전 거리:
√(200,000/π) - 40 ≈ 212 px
→ 200px로 감소 권장
```

**최종 결정: 옵션 A + B 혼합**

| 상수 | 기존 값 | 새 값 | 이유 |
|------|--------|-------|------|
| WORLD_SIZE | 2000 | 3000 | 20명 안전 스폰 보장 |
| SAFE_SPAWN_DISTANCE | 300 | 500 | slither.io 수준 안전 거리 |
| SPAWN_EDGE_MARGIN | 100 | 300 | 경계 여백 증가 |
| SPAWN_INVINCIBILITY_MS | 2000 | 3000 | 무적 시간 증가 |
| GRID_CELL_SIZE | - | 500 | 격자 셀 크기 (신규) |

### 3.4 카메라 줌 레벨 고려

맵 크기 증가 시 카메라 줌 조정 필요:
- 현재 줌: 1.0 (기본값)
- 가시 영역: 약 800 x 600 px (화면 크기에 따라 다름)
- 맵 크기 증가 후에도 동일한 줌 레벨 유지 (게임플레이 일관성)

## 4. 격자 기반 스폰 알고리즘 상세

### 4.1 알고리즘 흐름

```
1. 맵을 500x500 격자 셀로 분할 (6x6 = 36개 셀)
2. 각 셀의 플레이어 수 계산
3. 경계 여백(300px) 내 셀 제외
4. 가장 밀도가 낮은 셀 선택
5. 해당 셀 내에서 안전한 위치 탐색:
   a. 랜덤 위치 생성
   b. 모든 플레이어와 500px 이상 거리 확인
   c. 최대 50회 시도
6. 안전한 위치 없으면 셀 중심 반환
```

### 4.2 시간 복잡도

- 밀도 계산: O(n) - n은 플레이어 수
- 안전 위치 탐색: O(n * k) - k는 시도 횟수 (최대 50)
- 총 복잡도: O(n * k) = O(20 * 50) = O(1000) ≈ O(1)

### 4.3 폴백 전략

안전한 위치를 찾지 못할 경우:
1. 가장 밀도가 낮은 셀의 중심 위치 반환
2. 무적 시간 3초 부여로 보호

## 5. 성능 vs 게임플레이 트레이드오프

| 요소 | 성능 영향 | 게임플레이 영향 |
|------|----------|----------------|
| 맵 크기 증가 | 렌더링 부하 미미 | 플레이어 간 거리 증가 |
| 격자 계산 | 매우 낮음 (O(n)) | 없음 |
| 안전 거리 증가 | 없음 | 스폰 킬 방지 |
| 무적 시간 증가 | 없음 | 초보자 보호 강화 |

## 6. 결론

ChaosRPS.io의 스폰 시스템은 다음과 같이 설계합니다:

1. **격자 기반 밀도 계산**으로 가장 한산한 영역 선택
2. **500px 안전 거리**로 스폰 킬 방지
3. **3초 무적 시간**으로 추가 보호
4. **3000x3000 맵 크기**로 20명 안전 스폰 보장
5. **300px 경계 여백**으로 맵 가장자리 스폰 방지

이 설계는 slither.io의 공정한 스폰 시스템과 agar.io의 무적 시간 보호를 결합하여, 20명 규모의 게임에 최적화된 스폰 경험을 제공합니다.

---

**작성일**: 2025-12-30
**작성자**: Kiro AI Assistant
**관련 요구사항**: Requirements 1.1, 1.2, 1.3, 1.4, 11.1
