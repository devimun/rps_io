# 실시간 게임 서버 배포 스케일링 전략

## 개요

ChaosRPS.io와 같은 실시간 멀티플레이어 게임은 일반 웹 애플리케이션과 다른 인프라 요구사항을 가집니다. 이 문서는 유저 규모에 따른 최적의 배포 플랫폼 선택 가이드를 제공합니다.

## 실시간 게임 서버의 특수성

### 일반 웹 서버와의 차이점

| 구분 | 일반 웹 서버 | 실시간 게임 서버 |
|------|-------------|-----------------|
| 연결 방식 | HTTP (요청-응답) | WebSocket (지속 연결) |
| 레이턴시 허용치 | 500ms 이하 | 50-100ms 이하 |
| 서버 상태 | Stateless | Stateful (게임 상태 유지) |
| Cold Start 영향 | 첫 요청만 느림 | 게임 진행 불가 |
| 스케일링 방식 | 수평 확장 용이 | 방 단위 분산 필요 |

### 핵심 성능 지표

- **레이턴시(Latency)**: 클라이언트 → 서버 → 클라이언트 왕복 시간
- **틱레이트(Tick Rate)**: 서버가 초당 게임 상태를 업데이트하는 횟수 (현재 60Hz)
- **동시 접속자(CCU)**: 동시에 게임을 플레이하는 유저 수

---

## 단계별 배포 전략

### 1단계: MVP/테스트 (CCU 0-50명)

**권장 구성:**
- 클라이언트: Vercel (무료)
- 서버: Railway (무료 또는 Hobby $5/월)

**예상 비용:** $0-5/월

**장점:**
- 무료 또는 최소 비용
- 빠른 배포 및 CI/CD 자동화
- 관리 부담 없음

**단점:**
- Cold Start 발생 (첫 연결 시 2-3초 지연)
- 리전 제한 (주로 미국)
- 한국 유저 레이턴시 150-200ms+

**최적화 팁:**
```
Railway 설정에서 "Always On" 활성화 → Cold Start 방지
```

**이 단계에서 해야 할 것:**
- 게임 로직 검증
- 유저 피드백 수집
- 버그 수정 및 밸런싱

---

### 2단계: 초기 성장 (CCU 50-200명)

**권장 구성:**
- 클라이언트: Vercel (무료)
- 서버: Vultr/Linode 서울 VPS ($5-12/월)

**예상 비용:** $5-15/월

**권장 VPS 스펙:**
| 제공업체 | 플랜 | vCPU | RAM | 가격 |
|---------|------|------|-----|------|
| Vultr | High Frequency | 1 | 1GB | $6/월 |
| Linode | Nanode | 1 | 1GB | $5/월 |
| DigitalOcean | Basic | 1 | 1GB | $6/월 |

**장점:**
- 서울 리전 → 한국 유저 레이턴시 10-30ms
- Cold Start 없음 (항상 실행)
- 안정적인 WebSocket 연결

**단점:**
- 서버 관리 필요 (PM2, 모니터링 등)
- 수동 배포 또는 CI/CD 구성 필요

**서버 설정 예시:**
```bash
# PM2로 서버 실행 (자동 재시작)
pm2 start dist/index.js --name chaos-rps

# 로그 확인
pm2 logs chaos-rps

# 모니터링
pm2 monit
```

**이 단계에서 해야 할 것:**
- 서버 모니터링 구축 (PM2, Grafana 등)
- 에러 로깅 시스템 (Sentry 등)
- 백업 및 복구 계획

---

### 3단계: 성장기 (CCU 200-1000명)

**권장 구성:**
- 클라이언트: Cloudflare Pages (무료, 더 빠른 CDN)
- 서버: AWS Lightsail 서울 ($10-40/월)

**예상 비용:** $10-50/월

**권장 Lightsail 스펙:**
| CCU | vCPU | RAM | 가격 |
|-----|------|-----|------|
| ~300 | 1 | 2GB | $10/월 |
| ~500 | 2 | 4GB | $20/월 |
| ~1000 | 4 | 8GB | $40/월 |

**장점:**
- AWS 인프라 안정성
- 쉬운 스케일업 (클릭 몇 번으로 업그레이드)
- 고정 IP, 방화벽 관리

**아키텍처 변경 고려:**
```
[유저] → [Cloudflare CDN] → [정적 파일]
         ↓
[유저] → [AWS Lightsail 서울] → [게임 서버]
```

**이 단계에서 해야 할 것:**
- 로드 테스트 (Artillery, k6 등)
- 메모리 누수 점검
- 게임 방 분산 로직 검토

---

### 4단계: 스케일업 (CCU 1000-5000명)

**권장 구성:**
- 클라이언트: Cloudflare Pages
- 서버: AWS EC2 + Application Load Balancer
- 또는: AWS GameLift (게임 전용 서비스)

**예상 비용:** $50-200/월

**아키텍처:**
```
                    ┌─────────────────┐
                    │  Load Balancer  │
                    └────────┬────────┘
              ┌──────────────┼──────────────┐
              ▼              ▼              ▼
        ┌──────────┐  ┌──────────┐  ┌──────────┐
        │ Server 1 │  │ Server 2 │  │ Server 3 │
        │ (방 1-10)│  │(방 11-20)│  │(방 21-30)│
        └──────────┘  └──────────┘  └──────────┘
```

**핵심 고려사항:**
- **Sticky Session**: 같은 방의 유저는 같은 서버로 연결
- **방 분산**: 새 방 생성 시 가장 여유 있는 서버에 할당
- **서버 간 통신**: Redis Pub/Sub으로 서버 간 메시지 전달

**이 단계에서 해야 할 것:**
- 멀티 서버 아키텍처 구현
- Redis 도입 (세션 공유, Pub/Sub)
- 자동 스케일링 설정

---

### 5단계: 대규모 (CCU 5000명+)

**권장 구성:**
- 클라이언트: Cloudflare Pages + Workers (엣지 컴퓨팅)
- 서버: AWS GameLift 또는 Kubernetes (EKS)
- 글로벌: 멀티 리전 배포

**예상 비용:** $200-1000+/월

**글로벌 아키텍처:**
```
        [한국 유저]          [미국 유저]          [유럽 유저]
             │                   │                   │
             ▼                   ▼                   ▼
      ┌────────────┐      ┌────────────┐      ┌────────────┐
      │ 서울 리전  │      │ 버지니아   │      │ 프랑크푸르트│
      │ 게임 서버  │      │ 게임 서버  │      │ 게임 서버  │
      └────────────┘      └────────────┘      └────────────┘
             │                   │                   │
             └───────────────────┼───────────────────┘
                                 ▼
                          [글로벌 DB]
                          (DynamoDB)
```

---

## 마이그레이션 체크리스트

### Railway → VPS 이전 시

1. [ ] VPS 서버 생성 (서울 리전)
2. [ ] Node.js, PM2 설치
3. [ ] 방화벽 설정 (3001 포트 오픈)
4. [ ] SSL 인증서 설정 (Let's Encrypt)
5. [ ] 환경 변수 설정
6. [ ] 코드 배포 및 테스트
7. [ ] DNS 변경 (클라이언트 API URL)
8. [ ] 모니터링 설정 (PM2, 로그)
9. [ ] 기존 Railway 서버 유지 (롤백용)
10. [ ] 안정화 확인 후 Railway 종료

### VPS → AWS 이전 시

1. [ ] AWS 계정 및 IAM 설정
2. [ ] Lightsail/EC2 인스턴스 생성
3. [ ] 보안 그룹 설정
4. [ ] 기존 VPS와 동일한 환경 구성
5. [ ] 로드 테스트
6. [ ] DNS 변경
7. [ ] CloudWatch 모니터링 설정

---

## 비용 요약

| 단계 | CCU | 클라이언트 | 서버 | 월 비용 |
|------|-----|-----------|------|---------|
| MVP | 0-50 | Vercel 무료 | Railway $5 | $0-5 |
| 초기 성장 | 50-200 | Vercel 무료 | VPS $6-12 | $6-12 |
| 성장기 | 200-1000 | Cloudflare 무료 | Lightsail $10-40 | $10-40 |
| 스케일업 | 1000-5000 | Cloudflare 무료 | EC2 + LB | $50-200 |
| 대규모 | 5000+ | Cloudflare | GameLift/K8s | $200+ |

---

## 결론

**현재 단계 (MVP)에서는 Vercel + Railway로 충분합니다.**

다음 단계로 넘어가는 시점:
- **50 CCU 돌파** → 서울 VPS 검토
- **레이턴시 불만 증가** → 즉시 서울 VPS 이전
- **200 CCU 돌파** → AWS Lightsail 검토
- **서버 불안정** → 더 높은 스펙 또는 멀티 서버 검토

핵심은 **유저 피드백**입니다. 레이턴시 불만이 없다면 현재 구성을 유지하고, 불만이 생기면 그때 이전해도 늦지 않습니다.
